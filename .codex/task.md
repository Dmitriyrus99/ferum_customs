# üîß –ó–∞–¥–∞–Ω–∏–µ: —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –æ—à–∏–±–∫–∏ –≤ e2e-—Ç–µ—Å—Ç–µ –∏ –¥–æ–±–∞–≤–∏—Ç—å FSM-–ø—Ä–æ–≤–µ—Ä–∫—É

## –¶–µ–ª—å

–ü—Ä–∏–≤–µ—Å—Ç–∏ `tests/e2e/test_fsm_conversation.py` –≤ —Ä–∞–±–æ—á–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
- —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ Ruff (F841)
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç `Update`
- —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ FSM-—Ö–µ–Ω–¥–ª–µ—Ä–∞

---

## –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ:

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å F841**:
   - –ª–∏–±–æ —É–¥–∞–ª–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `update`, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
   - –ª–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ—ë, –ø–µ—Ä–µ–¥–∞–≤ –≤ FSM-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫

2. **–î–æ–±–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ FSM-—Ö–µ–Ω–¥–ª–µ—Ä–∞**:
   - –ù–∞–π—Ç–∏ `start_handler()` (–∏–ª–∏ –¥—Ä—É–≥–æ–π `/start`-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫) –≤ –ø—Ä–æ–µ–∫—Ç–µ
   - –≠–º—É–ª–∏—Ä–æ–≤–∞—Ç—å `Message` –∏ `FSMContext`
   - –í—ã–∑–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Ä—É—á–Ω—É—é: `await start_handler(message, state=context)`

3. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏**:
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å (`FSMContext.get_state()`)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç Telegram-–±–æ—Ç–∞, –µ—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ `bot.send_message`

4. **–û–±–µ—Å–ø–µ—á–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å `pytest`**:
   - –û—Å—Ç–∞–≤–∏—Ç—å `@pytest.mark.asyncio` –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É `async def`

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç

–†–∞–±–æ—á–∏–π —Ç–µ—Å—Ç, –Ω–µ –≤—ã–∑—ã–≤–∞—é—â–∏–π –æ—à–∏–±–æ–∫ Ruff, –∑–∞–ø—É—Å–∫–∞–µ–º—ã–π –≤ CI:

```python
async def test_fsm_start_handler():
    ...
    await start_handler(message, state=fsm_context)
    assert await fsm_context.get_state() == "SomeState"
