description: >
  Устранение ошибок pre-commit, mypy и pytest. Повышение стабильности CI.

goals:
  - Исправить ошибки ruff, включая неотсортированные импорты и неиспользуемые переменные.
  - Добавить или актуализировать аннотации типов в функциях, где возникают ошибки mypy.
  - Обновить тесты, чтобы не использовать реальные импорты aiogram, а применять заглушки/mocking.
  - Проверить и при необходимости обновить requirements.txt и requirements-dev.txt, чтобы aiogram, pytest, mypy и ruff были установлены.
  - Убедиться, что все тесты из tests/ проходят без ошибок.
  - Проверить, что pre-commit запускается без ошибок.

acceptance_criteria:
  - Команда `pre-commit run --all-files` выполняется без ошибок.
  - Команда `pytest -q` проходит успешно, без пропущенных или проваленных тестов.
  - Команда `mypy .` не выдаёт ошибок типов.

note:
  - Если какие-то зависимости отсутствуют — добавьте их в requirements-dev.txt.
  - Для FSM-тестов, если реальный Bot() не нужен — применяйте mocking.
