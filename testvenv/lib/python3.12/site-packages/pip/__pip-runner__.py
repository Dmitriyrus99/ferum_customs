"""Execute exactly this copy of pip, within a different environment.

This file is named as it is, to ensure that this module can't be imported via
an import statement.
"""

import sys
import runpy  # noqa: E402
from importlib.machinery import PathFinder  # noqa: E402
from os.path import dirname  # noqa: E402

# Copied from setup.py
PYTHON_REQUIRES = (3, 7)

def version_str(version):
    return ".".join(str(v) for v in version)

if sys.version_info[:2] < PYTHON_REQUIRES:
    raise SystemExit(
        "This version of pip does not support python {} (requires >={}).".format(
            version_str(sys.version_info[:2]), version_str(PYTHON_REQUIRES)
        )
    )

PIP_SOURCES_ROOT = dirname(dirname(__file__))

class PipImportRedirectingFinder:
    @classmethod
    def find_spec(cls, fullname, path=None, target=None):
        if fullname != "pip":
            return None

        spec = PathFinder.find_spec(fullname, [PIP_SOURCES_ROOT], target)
        assert spec, (PIP_SOURCES_ROOT, fullname)
        return spec

sys.meta_path.insert(0, PipImportRedirectingFinder())

if __name__ == "__main__":
    runpy.run_module("pip", run_name="__main__", alter_sys=True)
